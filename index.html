
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Interactiva TO - Monita 🌸</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff0f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #b64274;
    }
    .contenedor {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px 0;
    }
    .semestre {
      background: #ffe4ec;
      border: 2px solid #f8bcd9;
      border-radius: 12px;
      padding: 15px;
      min-width: 240px;
      max-width: 260px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }
    .semestre h2 {
      text-align: center;
      color: #b64274;
      font-size: 1.1em;
      margin-top: 0;
    }
    .ramo {
      background: #fff;
      border-radius: 8px;
      padding: 6px 10px;
      margin: 6px 0;
      display: flex;
      align-items: center;
      font-size: 0.95em;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.05);
    }
    .ramo input[type="checkbox"] {
      margin-right: 10px;
    }
    .ramo.locked {
      background-color: #f3f3f3;
      border: 1px dashed #bbb;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .ramo.completed {
      text-decoration: line-through;
      color: #aaa;
    }
    .formacion-general {
      background-color: #fdf0ff;
    }
    .verde {
      background-color: #e3fbe3;
    }
    .amarillo {
      background-color: #fff9d6;
    }
    .editable-label {
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: inherit;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Terapia Ocupacional PUC 🌷</h1>
  <div class="contenedor" id="malla"></div>
  <script>
    const malla = [{"semestre": "Semestre I", "ramos": [{"nombre": "Precálculo", "id": "MAT1000"}, {"nombre": "Biología de la Célula y Sistemas", "id": "BIO141C"}, {"nombre": "Integrado Ciencias Básicas", "id": "MET101A", "verde": true}, {"nombre": "Fundamentos Psicológicos TO", "id": "MET102A", "verde": true}, {"nombre": "Desarrollo Creativo", "id": "OCU101A", "amarillo": true}, {"nombre": "Profesión y Disciplina TO", "id": "OCU102A", "amarillo": true}]}, {"semestre": "Semestre II", "ramos": [{"nombre": "Física", "id": "FIS109A", "requisitos": []}, {"nombre": "Fisiología General", "id": "BIO135T", "requisitos": ["BIO141C"], "verde": true}, {"nombre": "Morfología General", "id": "MET201A", "requisitos": [], "verde": true}, {"nombre": "Ciclo Vital y Desarrollo", "id": "MET202A", "requisitos": ["MET102A"], "verde": true}, {"nombre": "Desarrollo Lúdico", "id": "OCU201A", "requisitos": ["OCU101A"], "amarillo": true}]}, {"semestre": "Semestre III", "ramos": [{"nombre": "Análisis del Movimiento Ocupacional", "id": "CSS301A", "requisitos": ["MET102A"], "amarillo": true}, {"nombre": "Fisiopatología", "id": "MET301A", "requisitos": ["BIO135T"], "verde": true}, {"nombre": "Psicología del Trabajo", "id": "PSI2502"}, {"nombre": "Neurociencias Aplicadas", "id": "CSS302A", "requisitos": ["MET202A"]}, {"nombre": "Habilidades y Técnicas Terapéuticas I", "id": "OCU301A", "requisitos": ["OCU201A"], "amarillo": true}]}, {"semestre": "Semestre IV", "ramos": [{"nombre": "Patologías del Sistema Músculo-Esquelético", "id": "CSS401A", "requisitos": ["MET301A"], "amarillo": true}, {"nombre": "Farmacología en Ciencias de la Salud", "id": "MET401A", "requisitos": ["BIO135T"], "amarillo": true}, {"nombre": "Bioestadística", "id": "MET402A", "requisitos": ["MAT1000"]}, {"nombre": "Alteraciones del Sistema Nervioso Adultos", "id": "MET403A", "requisitos": ["CSS302A"], "amarillo": true}, {"nombre": "Habilidades y Técnicas Terapéuticas II", "id": "OCU401A", "requisitos": ["OCU301A"], "amarillo": true}]}, {"semestre": "Semestre V", "ramos": [{"nombre": "Ergonomía e Inclusión Social", "id": "OCU501A", "requisitos": ["CSS401A"]}, {"nombre": "Semiología y Anamnesis", "id": "OCU502A", "requisitos": ["OCU401A"]}, {"nombre": "Salud Pública", "id": "MET501A", "requisitos": ["MET402A"]}, {"nombre": "Salud Mental en Niños y Adolescentes", "id": "MET502A", "requisitos": ["CSS302A"]}, {"nombre": "Bioética", "id": "MET503A", "requisitos": ["MET402A"]}]}, {"semestre": "Semestre VI", "ramos": [{"nombre": "Tecnologías de Apoyo a la Rehabilitación", "id": "OCU601A", "requisitos": ["OCU501A"]}, {"nombre": "Razonamiento Profesional", "id": "OCU602A", "requisitos": ["OCU502A"]}, {"nombre": "Rehabilitación Psicosocial", "id": "OCU603A", "requisitos": ["OCU502A"]}, {"nombre": "Salud Mental en Adulto", "id": "CSS601A", "requisitos": ["MET502A"]}, {"nombre": "Investigación Aplicada", "id": "MET601A", "requisitos": ["MET503A"]}]}, {"semestre": "Semestre VII", "ramos": [{"nombre": "Ortótica", "id": "OCU701A", "requisitos": ["OCU601A"]}, {"nombre": "Intervención en Niños y Adolescentes", "id": "OCU702A", "requisitos": ["OCU602A"]}, {"nombre": "Intervención Psicosocial y Comunitaria", "id": "OCU703A", "requisitos": ["OCU603A"]}, {"nombre": "Intervención en Salud Mental y Persona Mayor", "id": "OCU704A", "requisitos": ["CSS601A"]}]}, {"semestre": "Semestre VIII", "ramos": [{"nombre": "Intervención en Persona Mayor", "id": "OCU801A", "requisitos": ["OCU704A"]}, {"nombre": "Intervención en Salud Física", "id": "OCU802A", "requisitos": ["OCU702A"]}, {"nombre": "Unidad de Investigación", "id": "OCU803A", "requisitos": ["MET601A"]}]}, {"semestre": "Semestre IX", "ramos": [{"nombre": "Internado en Salud Física", "id": "OCU901A", "requisitos": ["OCU802A"]}, {"nombre": "Optativo de Profundización", "id": "OPT901", "formacion": true}, {"nombre": "Internado Electivo I", "id": "OCU905A", "formacion": true, "requisitos": ["OCU803A"]}]}, {"semestre": "Semestre X", "ramos": [{"nombre": "Internado en Salud Mental", "id": "OCU902A", "requisitos": ["OCU704A"]}, {"nombre": "Internado en Salud Sociocomunitario", "id": "OCU903A", "requisitos": ["OCU703A"]}, {"nombre": "Internado Electivo II", "id": "OCU906A", "formacion": true, "requisitos": ["OCU803A"]}]}, {"semestre": "Formación General", "ramos": [{"nombre": "Filosofía", "id": "FIL2001", "formacion": true}, {"nombre": "Teología", "id": "TTF", "formacion": true}, {"nombre": "Inglés", "id": "VRA2000", "formacion": true}, {"nombre": "Español", "id": "VRA100C", "formacion": true}, {"nombre": "Formación General 1", "id": "FGEXTRA1", "formacion": true, "editable": true}, {"nombre": "Formación General 2", "id": "FGEXTRA2", "formacion": true, "editable": true}, {"nombre": "Formación General 3", "id": "FGEXTRA3", "formacion": true, "editable": true}, {"nombre": "Formación General 4", "id": "FGEXTRA4", "formacion": true, "editable": true}, {"nombre": "Formación General 5", "id": "FGEXTRA5", "formacion": true, "editable": true}, {"nombre": "Formación General 6", "id": "FGEXTRA6", "formacion": true, "editable": true}, {"nombre": "Formación General 7", "id": "FGEXTRA7", "formacion": true, "editable": true}]}];
    const estado = JSON.parse(localStorage.getItem('estadoMallaTO')) || {};
    const nombres = JSON.parse(localStorage.getItem('nombresFG')) || {};

    function renderMalla() {
      const contenedor = document.getElementById('malla');
      contenedor.innerHTML = '';
      malla.forEach((sem, i) => {
        const divSem = document.createElement('div');
        divSem.className = 'semestre';
        divSem.dataset.index = i;
        const titulo = document.createElement('h2');
        titulo.textContent = sem.semestre;
        divSem.appendChild(titulo);
        sem.ramos.forEach((ramo, j) => {
          const divRamo = document.createElement('div');
          divRamo.className = 'ramo';
          if (ramo.formacion) divRamo.classList.add('formacion-general');
          if (ramo.verde) divRamo.classList.add('verde');
          if (ramo.amarillo) divRamo.classList.add('amarillo');
          const cumplidos = !ramo.requisitos || ramo.requisitos.every(req => estado[req]);
          if (!cumplidos && ramo.requisitos?.length > 0) divRamo.classList.add('locked');
          if (estado[ramo.id]) divRamo.classList.add('completed');
          divRamo.setAttribute('draggable', ramo.formacion ? 'true' : 'false');
          divRamo.dataset.sem = i; divRamo.dataset.index = j;

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = estado[ramo.id] || false;
          checkbox.disabled = !cumplidos && !checkbox.checked;
          checkbox.addEventListener('change', () => {
            estado[ramo.id] = checkbox.checked;
            localStorage.setItem('estadoMallaTO', JSON.stringify(estado));
            renderMalla();
          });

          let label;
          if (ramo.editable) {
            label = document.createElement('input');
            label.className = 'editable-label';
            label.value = nombres[ramo.id] || ramo.nombre;
            label.addEventListener('input', () => {
              nombres[ramo.id] = label.value;
              localStorage.setItem('nombresFG', JSON.stringify(nombres));
            });
          } else {
            label = document.createElement('label');
            label.textContent = ramo.nombre;
          }

          divRamo.appendChild(checkbox);
          divRamo.appendChild(label);
          divSem.appendChild(divRamo);
        });
        contenedor.appendChild(divSem);
      });
      setDragEvents();
    }

    function setDragEvents() {
      document.querySelectorAll('.ramo[draggable=true]').forEach(elem => {
        elem.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text/plain', JSON.stringify({
            sem: elem.dataset.sem,
            index: elem.dataset.index
          }));
        });
      });
      document.querySelectorAll('.semestre').forEach(container => {
        container.addEventListener('dragover', (e) => e.preventDefault());
        container.addEventListener('drop', (e) => {
          e.preventDefault();
          const data = JSON.parse(e.dataTransfer.getData('text/plain'));
          const sourceList = malla[data.sem].ramos;
          const ramo = sourceList.splice(data.index, 1)[0];
          const destino = container.dataset.index;
          malla[destino].ramos.push(ramo);
          renderMalla();
        });
      });
    }

    renderMalla();
  </script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<style>
  #felicitacion {
    position: fixed;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff0f5;
    color: #b64274;
    font-size: 2em;
    font-weight: bold;
    padding: 20px 40px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    z-index: 9999;
    display: none;
  }
</style>
<div id="felicitacion">¡Semestre aprobado, Monita! 🎉</div>
<script>
  function revisarSemestreAprobado() {
    const bloques = document.querySelectorAll('.semestre');
    bloques.forEach(bloque => {
      const checks = bloque.querySelectorAll('input[type="checkbox"]');
      const todosMarcados = [...checks].every(c => c.checked || c.disabled);
      if (todosMarcados && !bloque.classList.contains('felicitado')) {
        bloque.classList.add('felicitado');
        mostrarConfetti();
      }
    });
  }

  function mostrarConfetti() {
    const felicitacion = document.getElementById('felicitacion');
    felicitacion.style.display = 'block';
    confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
    setTimeout(() => {{
      felicitacion.style.display = 'none';
    }}, 4000);
  }
</script>
</body>
</html>
